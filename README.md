# 账号管理器 V1.1.0

<div align="center">

![Version](https://img.shields.io/badge/version-1.1.0-blue.svg)
![Chrome](https://img.shields.io/badge/Chrome-88%2B-green.svg)
![License](https://img.shields.io/badge/license-MIT-orange.svg)

一个功能强大的 Chrome 浏览器扩展，专为多网站、多账号管理而设计

[功能特性](#-核心功能) • [快速开始](#-安装使用说明) • [使用指南](#-使用指南) • [常见问题](#-常见问题)

</div>

---

## 📋 项目概述

账号管理器是一个专业的 Chrome 浏览器扩展插件，旨在帮助用户高效管理多个网站（开发、测试、生产等）下的多个账号。通过智能网站匹配、一键自动登录、数据加密存储等核心功能，让账号管理变得简单、安全、高效。

### 主要特点

- 🎯 **智能网站匹配**：自动识别当前页面所属网站，无需手动切换
- 🔐 **数据安全加密**：使用 AES-GCM 算法加密存储敏感信息
- 🚀 **一键自动登录**：智能识别表单并自动填充，快速完成登录
- 🎨 **双界面模式**：弹出窗口 + 悬浮面板，满足不同使用场景
- 💾 **数据备份恢复**：支持导入导出，数据安全有保障
- 🔍 **快速搜索**：实时搜索账号，快速定位目标

---

## ✨ 核心功能

### 1. 双界面操作模式

#### 弹出窗口（Popup）
- 点击扩展图标打开完整管理界面
- 提供网站和账号的完整管理功能
- 支持添加、编辑、删除操作
- 现代化 UI 设计，操作流畅直观

#### 悬浮面板（Floating Panel）
- 自动注入到匹配的登录页面
- 快速访问当前网站的账号列表
- 支持拖拽调整位置
- 仅在匹配页面显示，不影响正常浏览

### 2. 网站管理系统

#### 网站配置
- **网站名称**：自定义标识（如：开发网站、测试网站、生产网站）
- **登录页面 URL**：完整的登录页面地址，用于智能匹配
- **登录按钮配置**：可自定义登录按钮的 ID 和 Class，适配不同网站

#### 智能匹配机制
- **精确匹配**：当前页面 URL 与配置的登录页面 URL 完全一致
- **路径通配符**：支持 `/*` 通配符匹配（如：`https://example.com/login/*`）
- **自动切换**：访问匹配页面时自动切换到对应网站
- **URL 规范化**：自动忽略查询参数和锚点，只匹配协议+域名+路径

#### 网站管理
- 添加、编辑、删除网站
- 网站列表展示和快速切换
- 删除网站时自动清理关联账号

### 3. 账号管理功能

#### 账号信息
- **用户名**：账号的显示名称
- **账号**：登录使用的账号（邮箱或手机号）
- **密码**：登录密码（支持显示/隐藏切换）
- **备注**：可选的备注信息，便于区分和管理

#### 账号操作
- 添加、编辑、删除账号
- 账号关联到特定网站，分类管理
- 实时搜索功能，支持按用户名或账号搜索
- 密码显示/隐藏切换，方便查看和输入

### 4. 智能自动登录

#### 表单识别
- 智能识别页面中的用户名、账号、密码输入框
- 支持多种常见的表单字段名称和类型
- 自动适配不同网站的表单结构

#### 自动填充
- 一键自动填充登录表单
- 自动触发输入事件，确保表单验证通过
- 支持多种输入框选择器（name、type、id 等）

#### 自动提交
- 自动点击配置的登录按钮
- 支持 ID 和 Class 两种选择器
- 多种回退机制，提高成功率

### 5. 数据加密保护

#### 加密存储
- 使用 Web Crypto API 进行 AES-GCM 加密
- 密码在存储前自动加密
- 读取时自动解密，对用户透明

#### 安全机制
- 所有数据存储在 Chrome 本地存储中
- 数据不会上传到任何服务器
- 采用安全的加密算法，保护敏感信息

### 6. 数据备份与恢复

#### 数据导出
- 一键导出所有网站和账号数据
- 导出为 JSON 格式，便于备份和迁移
- 包含完整的数据结构和时间戳

#### 数据导入
- 支持从 JSON 文件恢复数据
- 自动验证数据格式，确保完整性
- 支持合并导入，相同 ID 的项目会被覆盖
- ⚠️ 导入会合并现有数据，请谨慎操作

---

## 🚀 安装使用说明

### 安装步骤

#### 1. 下载扩展文件

克隆或下载项目到本地：

```bash
git clone http://121.42.43.167:10010/zhangjianlong/account-manager.git
cd account-manager
```

确保文件结构完整：

```
account-manager/
├── icons/
│   └── icon.png
├── images/
│   └── (示例图片)
├── background.js
├── content.js
├── crypto-utils.js
├── manifest.json
├── popup.html
├── popup.js
├── styles.css
├── config.example.json
└── README.md
```

#### 2. 打开 Chrome 扩展程序页面

- 点击 Chrome 右上角的三个点菜单（⋮）
- 选择 **更多工具** → **扩展程序**
- 或直接访问：`chrome://extensions/`

#### 3. 启用开发者模式

在扩展程序页面右上角，开启 **开发者模式** 开关

#### 4. 加载扩展程序

- 点击 **加载已解压的扩展程序** 按钮
- 选择项目文件夹（account-manager）
- 扩展程序将自动加载并显示在扩展列表中

---

## 📖 使用指南

### 1. 网站管理

#### 添加网站

1. 点击扩展图标，打开弹出窗口
2. 点击网站选择器右侧的 **"+"** 按钮
3. 填写网站信息：
   - **网站名称**：如"开发网站"、"测试网站"、"生产网站"
   - **登录页面 URL**：完整的登录页面地址，如 `https://dev.example.com/login`
   - **登录按钮 ID**（可选）：登录按钮的 ID 属性，默认值为 `ch_login_btn`
   - **登录按钮 Class**（可选）：登录按钮的 Class 属性，默认值为 `formBtn`
4. 点击 **保存** 完成添加

#### 编辑/删除网站

- 在网站列表中点击 **编辑** 按钮修改网站信息
- 点击 **删除** 按钮删除网站
- ⚠️ **注意**：删除网站会同时删除该网站下的所有账号

#### 网站切换

- 在弹出窗口顶部的网站选择器中选择网站
- 或在网站列表中点击网站项快速切换
- 切换后立即显示对应网站的账号列表

### 2. 账号管理

#### 添加账号

1. 选择目标网站
2. 点击底部的 **"+ 添加账号"** 按钮
3. 填写账号信息：
   - **用户名**：账号的显示名称
   - **账号**：登录使用的账号（邮箱或手机号）
   - **密码**：登录密码（支持显示/隐藏切换）
   - **备注**：可选的备注信息
4. 点击 **保存** 完成添加

#### 编辑/删除账号

- 在账号列表中点击 **编辑** 按钮修改账号信息
- 点击 **删除** 按钮删除账号
- 删除前会弹出确认提示

#### 搜索账号

- 在搜索框中输入用户名或账号进行搜索
- 支持实时搜索，快速定位目标账号
- 搜索不区分大小写

### 3. 一键登录

#### 在弹出窗口中登录

1. 选择目标网站
2. 在账号列表中找到要登录的账号
3. 点击账号右侧的 **"登录"** 按钮
4. 系统会自动打开或切换到对应的登录页面并填充表单

#### 在悬浮面板中登录

1. 访问匹配的登录页面时，悬浮面板会自动显示在页面右上角
2. 在悬浮面板中选择网站（如果当前页面匹配多个网站）
3. 点击账号的 **"登录"** 按钮
4. 系统会自动填充表单并点击登录按钮

#### 拖拽调整位置

- 悬浮面板支持拖拽，可以调整到合适的位置
- 位置信息会自动保存，下次访问时保持
- 点击面板头部即可拖拽

### 4. 数据备份与恢复

#### 导出数据

1. 在弹出窗口底部点击 **"导出"** 按钮
2. 系统会自动下载包含所有网站和账号数据的 JSON 文件
3. 文件名格式：`account-manager-export-YYYY-MM-DD.json`
4. 建议定期备份，防止数据丢失

#### 导入数据

1. 在弹出窗口底部点击 **"导入"** 按钮
2. 选择之前导出的 JSON 文件
3. 系统会自动验证并导入数据
4. ⚠️ **注意**：导入会合并现有数据，相同 ID 的项目会被覆盖

---

## 🛠️ 技术实现

### 核心技术栈

- **前端技术**：HTML5 + CSS3 + JavaScript (ES6+)
- **扩展框架**：Chrome Extension Manifest V3
- **存储方案**：Chrome Storage API (local)
- **加密方案**：Web Crypto API (AES-GCM)
- **浏览器 API**：
  - Chrome Tabs API：标签页管理
  - Chrome Scripting API：脚本注入
  - Chrome Storage API：数据存储

### 架构设计

#### Service Worker (background.js)
- 处理扩展生命周期事件（安装、更新）
- 监听标签页更新，自动匹配网站
- 处理数据备份与恢复请求
- 管理网站匹配逻辑

#### Content Script (content.js)
- 注入到网页中，创建悬浮面板
- 实现表单自动填充功能
- 处理拖拽和位置保存
- 响应网站切换消息
- 监听 URL 变化（包括 SPA 路由变化）

#### Popup (popup.html/popup.js)
- 提供完整的管理界面
- 网站管理和账号管理
- 数据导入导出功能
- 搜索和筛选功能
- 现代化的 UI 设计

#### 加密工具 (crypto-utils.js)
- 提供密码加密和解密功能
- 使用 Web Crypto API 实现 AES-GCM 加密
- 确保敏感数据安全存储

### 安全机制

- **数据存储**：使用 Chrome Storage API 本地存储，数据不会上传到服务器
- **密码加密**：账号密码使用 AES-GCM 加密算法保护
- **XSS 防护**：使用安全的 DOM 操作方法（textContent、createElement），避免 innerHTML 导致的 XSS 风险
- **权限控制**：仅请求必要的 Chrome API 权限（storage、activeTab、scripting）
- **CSP 策略**：配置内容安全策略，防止代码注入攻击

### 兼容性

- **浏览器版本**：Chrome 88.0 及以上
- **操作系统**：Windows、macOS、Linux
- **网站兼容**：支持主流网站的登录表单结构

---

## 📁 项目结构

```
account-manager/
├── icons/                      # 图标文件夹
│   └── icon.png                # 扩展图标（16x16, 48x48, 128x128）
├── images/                     # 示例图片文件夹
│   └── (功能演示图片)
├── background.js               # Service Worker 后台脚本
├── content.js                  # 内容脚本（悬浮面板）
├── crypto-utils.js             # 加密工具类
├── manifest.json               # 扩展配置文件（Manifest V3）
├── popup.html                  # 弹出窗口 HTML 结构
├── popup.js                    # 弹出窗口功能实现
├── styles.css                  # 样式文件（悬浮面板和弹出窗口）
├── config.example.json         # 配置示例文件
├── README.md                   # 项目说明文档
└── 账号管理器功能说明文档.md   # 详细功能说明文档
```

### 主要文件说明

#### manifest.json
- 扩展的配置文件，符合 Manifest V3 规范
- 声明权限、Service Worker、内容脚本等
- 定义扩展的基本信息（名称、版本、描述等）

#### background.js
- Service Worker 后台服务脚本
- 处理扩展的安装和更新事件
- 监听标签页更新，自动匹配和切换网站
- 实现数据备份与恢复的消息处理

#### content.js
- 内容脚本，注入到所有网页中
- 创建和管理悬浮式操作面板
- 实现账号列表展示和一键登录功能
- 支持面板拖拽和位置保存
- 处理网站切换消息
- 监听 URL 变化（SPA 路由）

#### popup.html / popup.js
- 弹出窗口的 HTML 结构和功能实现
- 提供完整的网站管理和账号管理界面
- 支持账号的添加、编辑、删除操作
- 实现搜索、导入导出等功能
- 使用现代化的 UI 设计，提供良好的用户体验

#### crypto-utils.js
- 加密工具类
- 使用 Web Crypto API 进行 AES-GCM 加密
- 提供密码加密和解密方法
- 确保敏感数据安全存储

#### styles.css
- 统一的样式文件
- 定义悬浮面板和弹出窗口的样式
- 使用 CSS 变量实现主题系统
- 确保界面美观和响应式设计

---

## 🔒 安全说明

1. **数据存储**：所有账号信息存储在 Chrome 的本地存储中，不会上传到任何服务器
2. **密码加密**：账号密码使用 AES-GCM 加密算法保护，即使数据泄露也难以破解
3. **权限控制**：仅请求必要的 Chrome API 权限，最小化权限原则
4. **XSS 防护**：使用安全的 DOM 操作方法，避免代码注入风险
5. **安全建议**：
   - 定期备份数据到安全位置
   - 不要在公共计算机上使用
   - 设置强密码保护账号信息
   - 不要分享导出的数据文件

---

## 📝 配置说明

### 网站配置

每个网站包含以下配置项：

- **网站名称**：网站的显示名称（必填）
- **登录页面 URL**：完整的登录页面地址，用于匹配（必填）
- **登录按钮 ID**：登录按钮的 ID 属性（可选，默认：`ch_login_btn`）
- **登录按钮 Class**：登录按钮的 Class 属性（可选，默认：`formBtn`）

### URL 匹配规则

- **精确匹配**：当前页面 URL 与登录页面 URL 完全一致
- **路径通配符**：支持在登录页面 URL 末尾使用 `/*` 进行路径匹配
  - 例如：`https://example.com/login/*` 可以匹配 `https://example.com/login` 及其子路径
- **URL 规范化**：自动忽略查询参数（`?`）和锚点（`#`），只匹配协议+域名+路径

### 数据格式

导出的 JSON 文件格式：

```json
{
  "version": "1.1.0",
  "exportTime": "2024-01-01T00:00:00.000Z",
  "environments": [
    {
      "id": "env_001",
      "name": "开发网站",
      "loginUrl": "https://dev.example.com/login",
      "loginButtonId": "ch_login_btn",
      "loginButtonClass": "formBtn",
      "createdAt": 1704067200000,
      "updatedAt": 1704067200000
    }
  ],
  "accounts": [
    {
      "id": "acc_001",
      "envId": "env_001",
      "username": "开发账号1",
      "account": "dev_user1@example.com",
      "password": "encrypted_password",
      "note": "开发网站测试账号",
      "createdAt": 1704067200000,
      "updatedAt": 1704067200000
    }
  ]
}
```

---

## ❓ 常见问题

### Q: 如何备份账号数据？

**A:** 在弹出窗口底部点击"导出"按钮，系统会自动下载包含所有数据的 JSON 文件。建议定期备份，防止数据丢失。

### Q: 如何恢复账号数据？

**A:** 在弹出窗口底部点击"导入"按钮，选择之前导出的 JSON 文件即可。⚠️ **注意**：导入会合并现有数据，相同 ID 的项目会被覆盖，请谨慎操作。

### Q: 账号信息是否安全？

**A:** 账号信息使用 Chrome Storage API 存储在本地，密码经过 AES-GCM 加密，不会上传到服务器，安全性较高。但仍建议定期备份数据。

### Q: 悬浮面板不显示怎么办？

**A:** 请检查：
1. 当前页面 URL 是否匹配某个网站的登录页面 URL
2. 是否在匹配的登录页面（悬浮面板只在匹配的页面显示）
3. 检查浏览器控制台是否有错误信息
4. 尝试刷新页面

### Q: 自动登录不工作怎么办？

**A:** 请检查：
1. 登录按钮的 ID 或 Class 配置是否正确
2. 页面中是否存在对应的登录表单元素
3. 检查浏览器控制台是否有错误信息
4. 可以尝试手动配置登录按钮的 ID 和 Class
5. 某些网站可能需要手动点击登录按钮

### Q: 支持哪些网站的自动登录？

**A:** 理论上支持所有标准的 HTML 登录表单。如果遇到不兼容的情况，可以：
1. 检查并配置正确的登录按钮 ID 和 Class
2. 查看浏览器控制台的错误信息
3. 提交 Issue 反馈问题

### Q: 如何设置主密码？

**A:** 当前版本使用系统级加密，暂不支持自定义主密码。未来版本可能会添加此功能。

### Q: 数据存储在哪里？

**A:** 数据存储在 Chrome 浏览器的本地存储中，不会上传到服务器。可以通过 Chrome DevTools 的 Application → Storage → Local Storage 查看。

### Q: 支持多账号同时登录吗？

**A:** 当前版本不支持多账号同时登录。未来版本可能会添加此功能。

### Q: 如何配置登录按钮？

**A:** 在网站配置中填写登录按钮的 ID 或 Class。如果不填写，系统会使用默认值（ID: `ch_login_btn`, Class: `formBtn`）。如果默认值不匹配，可以：
1. 打开目标网站的登录页面
2. 使用浏览器开发者工具检查登录按钮的 ID 或 Class
3. 在网站配置中填写正确的值

---

## 🗺️ 版本历史

### v1.1.0 (当前版本)

- ✅ 移除域名字段，简化网站配置
- ✅ 优化网站匹配逻辑，支持路径通配符
- ✅ 改进悬浮面板显示逻辑，仅在匹配页面显示
- ✅ 增强表单自动填充功能
- ✅ 优化 UI 设计，提升用户体验
- ✅ 添加搜索功能
- ✅ 改进错误处理和提示信息
- ✅ 修复 XSS 安全风险
- ✅ 优化代码结构和性能
- ✅ 支持 SPA 路由变化监听

### v1.0.0

- ✅ 初始版本发布
- ✅ 实现网站管理和账号管理功能
- ✅ 支持一键登录和自动网站切换
- ✅ 实现数据加密功能
- ✅ 双界面操作模式（弹出页面和悬浮面板）
- ✅ 数据导入导出功能

---

## 🔮 未来计划

- [ ] 支持自定义主密码
- [ ] 提供更多搜索和筛选选项
- [ ] 支持批量导入导出账号
- [ ] 增加快捷键操作
- [ ] 支持账号使用统计和记录
- [ ] 增强表单自动填充的兼容性
- [ ] 支持多账号同时登录
- [ ] 提供更多主题选项
- [ ] 支持数据同步（可选）
- [ ] 支持账号分组管理
- [ ] 支持密码强度检测
- [ ] 支持账号过期提醒

---

## 📞 联系方式

如有问题或建议，请通过以下方式联系：

- **GitLab**：http://121.42.43.167:10010/zhangjianlong/account-manager.git
- **Issues**：在 GitLab 仓库提交 Issue

---

## 📄 许可证

本项目采用 MIT 许可证，详见 LICENSE 文件。

---

<div align="center">

**⚠️ 重要提示**

本扩展仅用于合法的账号管理目的，请勿用于任何非法用途。使用本扩展即表示您同意自行承担使用风险。

**🔒 安全建议**

- 定期备份数据到安全位置
- 不要在公共计算机上使用
- 设置强密码保护账号信息
- 不要分享导出的数据文件

</div>
